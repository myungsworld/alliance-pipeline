{
  "name": "alliance-pipeline",
  "nodes": [
    {
      "parameters": {
        "updates": ["message", "callback_query"],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [-800, 200],
      "id": "e0039219-3bab-40ba-91e8-7f6e8772fa64",
      "name": "start channel",
      "webhookId": "ecc2bbaa-3376-4eb1-992d-5f480e1df106",
      "credentials": {
        "telegramApi": {
          "id": "zO8pBT6fKs3aHm6n",
          "name": "start channel"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "ì¡°ìš°",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "884eb7aa-ef71-4d22-9a84-11895c5b79b4"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "f08b5471-61ba-4000-b360-4cd0e2b9e9b5",
                    "leftValue": "={{ $json.message.text }}",
                    "rightValue": "ëŒ€ê²°",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.callback_query.message.reply_markup.inline_keyboard[0][0].callback_data }}",
                    "rightValue": "select_",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    },
                    "id": "9b6bbae0-5878-4030-99bd-0d5abd938d10"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "704cc383-b12d-47da-b44f-f7b42dfef6e8",
                    "leftValue": "={{ $json.callback_query.data }}",
                    "rightValue": "vs_",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [-560, 200],
      "id": "9bfe1d11-01fa-4d5b-9894-1efcc429b90c",
      "name": "ë©”ì¸ ë¼ìš°í„°"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    o.id as object_id, o.name as object_name, o.name_en as object_name_en,\n    c.id as creature_id, c.name as creature_name, c.name_en as creature_name_en\nFROM objects o\nCROSS JOIN creatures c\nWHERE NOT EXISTS (\n    SELECT 1 FROM combinations_used cu\n    WHERE cu.object_id = o.id AND cu.creature_id = c.id\n)\nORDER BY RANDOM()\nLIMIT 10;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [-300, -100],
      "id": "c563714b-79ca-49d3-a042-d14f964ca875",
      "name": "ëœë¤ì¡°í•© ì¿¼ë¦¬",
      "credentials": {
        "postgres": {
          "id": "ZwpbCKcvAHS9Ywfz",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst buttons = items.map(item => [{\n  text: `${item.json.object_name} + ${item.json.creature_name}`,\n  callback_data: `select_${item.json.object_id}_${item.json.creature_id}`\n}]);\n\nreturn [{\n  json: {\n    chat_id: \"8201163317\",\n    text: \"ğŸ² ëœë¤ì¡°í•© ëª…ì´ì˜ ì„ íƒì€?:\",\n    reply_markup: {\n      inline_keyboard: buttons\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-60, -100],
      "id": "f6471842-e9c6-4e80-98ac-c59ad2041cdd",
      "name": "ì¡°ìš° ë²„íŠ¼ ìƒì„±"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.telegram.org/bot8550742589:AAFNn4FR-0cEPPOqEkAZsXTo-lL-85CtkUo/sendMessage",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [180, 0],
      "id": "e01e5366-0a95-41a5-b69b-00655200dfe1",
      "name": "í…”ë ˆê·¸ë¨ ì „ì†¡"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    o.id as object_id,\n    o.name as object_name,\n    c.id as creature_id,\n    c.name as creature_name\nFROM objects o\nCROSS JOIN creatures c\nWHERE NOT EXISTS (\n    SELECT 1 FROM combinations_used cu\n    WHERE cu.object_id = o.id AND cu.creature_id = c.id\n)\nORDER BY RANDOM()\nLIMIT 10;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [-300, 100],
      "id": "74c1d2ef-6aa7-4da1-8fbb-a798dce2241c",
      "name": "ëŒ€ê²° ì¿¼ë¦¬",
      "credentials": {
        "postgres": {
          "id": "ZwpbCKcvAHS9Ywfz",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// 2ê°œì”© ë¬¶ì–´ì„œ vs ë²„íŠ¼ ìƒì„±\nconst buttons = [];\nfor (let i = 0; i < items.length - 1; i += 2) {\n  const item1 = items[i].json;\n  const item2 = items[i + 1].json;\n  \n  buttons.push([{\n    text: `${item1.creature_name} + ${item1.object_name} vs ${item2.creature_name} + ${item2.object_name}`,\n    callback_data: `vs_${item1.object_id}_${item1.creature_id}_${item2.object_id}_${item2.creature_id}`\n  }]);\n}\n\n// âœ… ë°˜ë“œì‹œ ë°°ì—´ ì•ˆì— json ê°ì²´ë¡œ ë°˜í™˜í•´ì•¼ í•¨\nreturn [{\n  json: {\n    chat_id: \"8201163317\",\n    text: \"âš”ï¸ ëŒ€ê²°! ì–´ë–¤ ì¡°í•©ì´ ì´ê¸¸ê¹Œ?\",\n    reply_markup: {\n      inline_keyboard: buttons\n    }\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-60, 100],
      "id": "872071e1-af02-430e-bb15-feda4639c04e",
      "name": "ëŒ€ê²° ë²„íŠ¼ ìƒì„±"
    },
    {
      "parameters": {
        "jsCode": "// callback_dataì—ì„œ object_id, creature_id ì¶”ì¶œ\nconst callbackData = $input.first().json.callback_query.data;\n// \"select_204_141\" â†’ [\"select\", \"204\", \"141\"]\nconst parts = callbackData.split('_');\n\nreturn {\n  object_id: parseInt(parts[1]),\n  creature_id: parseInt(parts[2])\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-300, 300],
      "id": "7ba8787b-bc03-4b59-911a-26b9d7a0b973",
      "name": "ì¡°ìš°"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n    o.id as object_id, o.name as object_name, o.name_en as object_name_en,\n    c.id as creature_id, c.name as creature_name, c.name_en as creature_name_en\nFROM objects o, creatures c\nWHERE o.id = {{ $json.object_id }} AND c.id = {{ $json.creature_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [-60, 300],
      "id": "6473ea98-161a-4cf9-8d03-28f8ac89b4c5",
      "name": "queryEncounter",
      "credentials": {
        "postgres": {
          "id": "ZwpbCKcvAHS9Ywfz",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.creature_name_en }} When encountering {{ $json.object_name_en }}, list 5 funny situations that could happen.\n\ngo to the point , do not verbose.",
        "hasOutputParser": true,
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.9,
      "position": [180, 300],
      "id": "e94d3455-bdbe-4cf3-8ad7-08b7e57b8535",
      "name": "script1"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "INSERT INTO encounter_scripts \n(object_id, creature_id, object_name, creature_name, situations)\nVALUES \n(\n{{ $('queryEncounter').item.json.object_id}}, \n{{ $('queryEncounter').item.json.creature_id }}, \n  '{{ $json.output.object_name.replace(/'/g, \"''\") }}',\n  '{{ $json.output.creature_name.replace(/'/g, \"''\") }}',\n  '{{ JSON.stringify($json.output.situation).replace(/'/g, \"''\") }}'::jsonb\n)\nRETURNING id;",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [420, 300],
      "id": "ee8cc350-883d-40ba-a59a-48e9d02da1fb",
      "name": "insertEncounterScript",
      "credentials": {
        "postgres": {
          "id": "ZwpbCKcvAHS9Ywfz",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const input = $('script1').first().json.output;\nconst creature = input.creature_name;\nconst object = input.object_name;\nconst situations = input.situation;\n\nconst situationList = situations\n  .map((s, i) => `${i + 1}. ${s}`)\n  .join('\\n');\n\nconst message = `ì¡°ìš° ì‹œë‚˜ë¦¬ì˜¤\n\nì¡°í•©: ${creature} + ${object}\n\nìƒí™©:\n${situationList}`;\n\nreturn {\n  text: message,\n  encounter_scripts : $input.first().json.id\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [660, 300],
      "id": "d20e098e-d6e6-4576-a753-da4a1fa85711",
      "name": "ì‹œë‚˜ë¦¬ì˜¤ í¬ë§·"
    },
    {
      "parameters": {
        "chatId": "8201163317",
        "text": "={{ $json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "ì´ë¯¸ì§€ ìƒì„±",
                    "additionalFields": {
                      "callback_data": "=encounter_{{ $json.encounter_scripts }}"
                    }
                  },
                  {
                    "text": "ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤",
                    "additionalFields": {
                      "callback_data": "retry_encounter"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [900, 300],
      "id": "e5399fd6-2257-43d9-b303-ed0534ecd56d",
      "name": "write script",
      "webhookId": "576ba25b-54fa-44e4-8cd8-390593daa8ab",
      "credentials": {
        "telegramApi": {
          "id": "hjKKDhzAr95XXqw9",
          "name": "script-bot"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const callbackData = $input.first().json.callback_query.data;\n// \"vs_204_141_55_78\" â†’ [\"vs\", \"204\", \"141\", \"55\", \"78\"]\nconst parts = callbackData.split('_');\n\nreturn {\n  team1_object_id: parseInt(parts[1]),\n  team1_creature_id: parseInt(parts[2]),\n  team2_object_id: parseInt(parts[3]),\n  team2_creature_id: parseInt(parts[4])\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [-300, 550],
      "id": "57074280-071e-4892-8ad3-4110bf8971f6",
      "name": "ëŒ€ê²°"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT \n  o1.name as team1_object, c1.name as team1_creature,\n  o2.name as team2_object, c2.name as team2_creature\nFROM objects o1, creatures c1, objects o2, creatures c2\nWHERE o1.id = {{ $json.team1_object_id }}\n  AND c1.id = {{ $json.team1_creature_id }}\n  AND o2.id = {{ $json.team2_object_id }}\n  AND c2.id = {{ $json.team2_creature_id }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [-60, 550],
      "id": "a77c92a9-4b38-4ad3-8480-9d93b116ce29",
      "name": "ëŒ€ê²° íŒ€ ì¿¼ë¦¬",
      "credentials": {
        "postgres": {
          "id": "ZwpbCKcvAHS9Ywfz",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=\"{{ $json.team1_object }} ì„(ë¥¼) ê°€ì§„ {{ $json.team1_creature }}\" vs \"{{ $json.team2_object }} ì„(ë¥¼) ê°€ì§„ {{ $json.team2_creature }}\"\n\nìœ„ì˜ ì†Œì¬ë¡œ ìˆí¼ ì»¨í…ì¸ ë¥¼ ìƒì„±í•˜ê³  ì‹¶ì–´\ní˜„ì‹¤ì ì¸ê±´ ìƒê´€ì—†ì–´ ê·¸ëƒ¥ ì¬ë°Œìœ¼ë©´ ë¼ \në§Œì•½ ë‘ ì†Œì¬ê°€ í„°ë¬´ë‹ˆì—†ì´ ë°¸ëŸ°ìŠ¤ê°€ ë§ì§€ ì•Šìœ¼ë©´ í™˜ê²½ì´ë‚˜ ìƒí™©ì„ ë§ˆìŒëŒ€ë¡œ ì›ƒê¸°ê²Œ ì¶”ê°€í•´ì„œ ë°¸ëŸ°ìŠ¤ë¥¼ ë§ì¶°ì£¼ë©´ ë¼\n\nì´ê±¸ ê¸°ë°˜ìœ¼ë¡œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì¨ì¤˜\n\n",
        "batching": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chainLlm",
      "typeVersion": 1.9,
      "position": [180, 550],
      "id": "e47d2a60-62ee-4e5b-acc5-a3fa826cd3ab",
      "name": "script2"
    },
    {
      "parameters": {
        "chatId": "8201163317",
        "text": "={{ $json.text }}",
        "replyMarkup": "inlineKeyboard",
        "inlineKeyboard": {
          "rows": [
            {
              "row": {
                "buttons": [
                  {
                    "text": "ì´ë¯¸ì§€ìƒì„±",
                    "additionalFields": {
                      "callback_data": "create_image"
                    }
                  }
                ]
              }
            }
          ]
        },
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [420, 550],
      "id": "48f4cdc3-2182-4286-83dc-b7b1476a97a7",
      "name": "ëŒ€ê²° ê²°ê³¼ ì „ì†¡",
      "webhookId": "7b27604d-fc4d-46b7-805e-763a29d7c51c",
      "credentials": {
        "telegramApi": {
          "id": "hjKKDhzAr95XXqw9",
          "name": "script-bot"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "temperature": 1,
          "topK": 32,
          "topP": 1
        }
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [100, 480],
      "id": "89033ab7-e1c4-4fd5-aae3-a9c2beeba776",
      "name": "Google Gemini Chat Model",
      "alwaysOutputData": false,
      "credentials": {
        "googlePalmApi": {
          "id": "T6hLQOKnt40dUWSA",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsonSchemaExample": "{\n\t\"object_name\": \"pencil\",\n    \"creature_name\": \"robot\",\n    \"situation\" : [\"\",\"\",\"\",\"\",\"\"]\n}"
      },
      "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
      "typeVersion": 1.3,
      "position": [260, 480],
      "id": "72528a0e-a5da-4a76-a70b-b506ba1fb0f2",
      "name": "Structured Output Parser"
    },
    {
      "parameters": {
        "updates": ["callback_query"],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [-800, 800],
      "id": "c44ca9ff-ecd2-4593-b3fb-c526359d44cf",
      "name": "script button handler",
      "webhookId": "e208720f-2758-4c30-afd2-f889a2b5d099",
      "credentials": {
        "telegramApi": {
          "id": "hjKKDhzAr95XXqw9",
          "name": "script-bot"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.callback_query.message.reply_markup.inline_keyboard[0][0].callback_data }}",
                    "rightValue": "encounter_",
                    "operator": {
                      "type": "string",
                      "operation": "startsWith"
                    },
                    "id": "75020585-3f98-47bc-93dd-7be0926e0c42"
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.4,
      "position": [-560, 800],
      "id": "92fd8234-ec16-40f2-a0af-846d5e372c93",
      "name": "ì´ë¯¸ì§€ ë¼ìš°í„°"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "SELECT * FROM encounter_scripts \nWHERE id = CAST(SPLIT_PART('{{ $json.callback_query.message.reply_markup.inline_keyboard[0][0].callback_data }}', '_', 2) AS INTEGER);",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.6,
      "position": [-300, 800],
      "id": "f7ecd388-3cc6-4372-9658-cb7e5fcad654",
      "name": "encounter ì¿¼ë¦¬",
      "credentials": {
        "postgres": {
          "id": "ZwpbCKcvAHS9Ywfz",
          "name": "Postgres account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.replicate.com/v1/predictions",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Token {{ $env.REPLICATE_API_TOKEN }}"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"version\": \"39ed52f2a78e934b3ba6e2a89f5b1c712de7dfea535525255b1aa35c5565e08b\",\n  \"input\": {\n    \"prompt\": \"{{ $json.situations[0] }}, very low effort doodle drawing, intentionally badly drawn, childlike mouse drawing, uneven thick lines, poor proportions, simple face with dot eyes and round mouth, minimal colors, black background, looks silly and pointless\",\n    \"negative_prompt\": \"realistic, detailed, professional, masterpiece, anime, smooth lines, shading, 3d, render, high quality, text, watermark, logo\",\n    \n    \"width\": 1024,\n    \"height\": 1024\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [-60, 800],
      "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
      "name": "Replicate ì´ë¯¸ì§€ ìƒì„±"
    },
    {
      "parameters": {
        "amount": 3
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [180, 800],
      "id": "b2c3d4e5-f6a7-8901-bcde-f23456789012",
      "name": "Wait",
      "webhookId": "wait-webhook-id-1"
    },
    {
      "parameters": {
        "url": "={{ $('Replicate ì´ë¯¸ì§€ ìƒì„±').item.json.urls.get }}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "=Token {{ $env.REPLICATE_API_TOKEN }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [420, 800],
      "id": "c3d4e5f6-a7b8-9012-cdef-345678901234",
      "name": "Replicate ê²°ê³¼ í™•ì¸"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "leftValue": "={{ $json.status }}",
              "rightValue": "succeeded",
              "operator": {
                "type": "string",
                "operation": "equals"
              },
              "id": "condition-succeeded"
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [660, 800],
      "id": "d4e5f6a7-b8c9-0123-defa-456789012345",
      "name": "ì´ë¯¸ì§€ ì™„ë£Œ?"
    },
    {
      "parameters": {
        "operation": "sendPhoto",
        "chatId": "={{ $env.TELEGRAM_CHAT_ID }}",
        "file": "={{ $json.output[0] }}",
        "additionalFields": {
          "caption": "=ğŸ¨ {{ $('encounter ì¿¼ë¦¬').item.json.creature_name }} + {{ $('encounter ì¿¼ë¦¬').item.json.object_name }}"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [900, 700],
      "id": "e5f6a7b8-c9d0-1234-efab-567890123456",
      "name": "Telegram ì´ë¯¸ì§€ ì „ì†¡",
      "webhookId": "591f03c3-ff53-418d-babf-9ae05ee1ca3a",
      "credentials": {
        "telegramApi": {
          "id": "hjKKDhzAr95XXqw9",
          "name": "script-bot"
        }
      }
    }
  ],
  "connections": {
    "start channel": {
      "main": [
        [
          {
            "node": "ë©”ì¸ ë¼ìš°í„°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë©”ì¸ ë¼ìš°í„°": {
      "main": [
        [
          {
            "node": "ëœë¤ì¡°í•© ì¿¼ë¦¬",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ëŒ€ê²° ì¿¼ë¦¬",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ì¡°ìš°",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ëŒ€ê²°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ëœë¤ì¡°í•© ì¿¼ë¦¬": {
      "main": [
        [
          {
            "node": "ì¡°ìš° ë²„íŠ¼ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¡°ìš° ë²„íŠ¼ ìƒì„±": {
      "main": [
        [
          {
            "node": "í…”ë ˆê·¸ë¨ ì „ì†¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ëŒ€ê²° ì¿¼ë¦¬": {
      "main": [
        [
          {
            "node": "ëŒ€ê²° ë²„íŠ¼ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ëŒ€ê²° ë²„íŠ¼ ìƒì„±": {
      "main": [
        [
          {
            "node": "í…”ë ˆê·¸ë¨ ì „ì†¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì¡°ìš°": {
      "main": [
        [
          {
            "node": "queryEncounter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "queryEncounter": {
      "main": [
        [
          {
            "node": "script1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "script1": {
      "main": [
        [
          {
            "node": "insertEncounterScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "insertEncounterScript": {
      "main": [
        [
          {
            "node": "ì‹œë‚˜ë¦¬ì˜¤ í¬ë§·",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì‹œë‚˜ë¦¬ì˜¤ í¬ë§·": {
      "main": [
        [
          {
            "node": "write script",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ëŒ€ê²°": {
      "main": [
        [
          {
            "node": "ëŒ€ê²° íŒ€ ì¿¼ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ëŒ€ê²° íŒ€ ì¿¼ë¦¬": {
      "main": [
        [
          {
            "node": "script2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "script2": {
      "main": [
        [
          {
            "node": "ëŒ€ê²° ê²°ê³¼ ì „ì†¡",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "script1",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "script2",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Structured Output Parser": {
      "ai_outputParser": [
        [
          {
            "node": "script1",
            "type": "ai_outputParser",
            "index": 0
          }
        ]
      ]
    },
    "script button handler": {
      "main": [
        [
          {
            "node": "ì´ë¯¸ì§€ ë¼ìš°í„°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì´ë¯¸ì§€ ë¼ìš°í„°": {
      "main": [
        [
          {
            "node": "encounter ì¿¼ë¦¬",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "encounter ì¿¼ë¦¬": {
      "main": [
        [
          {
            "node": "Replicate ì´ë¯¸ì§€ ìƒì„±",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replicate ì´ë¯¸ì§€ ìƒì„±": {
      "main": [
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait": {
      "main": [
        [
          {
            "node": "Replicate ê²°ê³¼ í™•ì¸",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Replicate ê²°ê³¼ í™•ì¸": {
      "main": [
        [
          {
            "node": "ì´ë¯¸ì§€ ì™„ë£Œ?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì´ë¯¸ì§€ ì™„ë£Œ?": {
      "main": [
        [
          {
            "node": "Telegram ì´ë¯¸ì§€ ì „ì†¡",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "meta": null,
  "pinData": null,
  "triggerCount": 2
}
